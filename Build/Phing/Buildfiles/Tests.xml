<?xml version="1.0"?>
<project name="Tests">

	<target name="lint" depends="lint-php" description="Run lint on source files"/>
	<target name="test" depends="test-phpunit" description="Run lint on source files"/>


	<target name="lint-php">
		<mkdir dir="${project.reportsDirectory}"/>
		<phplint haltonfailure="true" level="debug" tofile="${project.reportsDirectory}/Lint.txt">
			<fileset refid="files-php"/>
		</phplint>
	</target>

	<target name="lint-docbook">
		<xmllint schema="${project.buildDirectory}/Resources/Manual/Xsd/docbook.xsd">
			<fileset refid="files-docbook-xml"/>
		</xmllint>
	</target>


	<target name="test-phpunit" description="Run unit tests (XML output)">
		<mkdir dir="${project.buildDirectory}/Temporary"/>
		<mkdir dir="${project.reportsDirectory}"/>

		<includepath classpath="Build/Resources"/>

		<coverage-setup database="${project.buildDirectory}/Temporary/coverage.db">
			<fileset refid="files-php"/>
		</coverage-setup>

		<phpunit codecoverage="true" haltonfailure="true" printsummary="true" bootstrap="${project.buildDirectory}/Scripts/Bootstrap.php">
			<formatter todir="${project.reportsDirectory}" outfile="unittests.xml" type="xml"/>
			<batchtest>
				<fileset refid="files-unittests"/>
			</batchtest>
		</phpunit>
	</target>

</project>